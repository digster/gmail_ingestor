# 2026-02-27: Rate Limiting, Backoff & Retry + Multi-Label Support

## Changes Made

### Rate Limiting & Retry (`gmail_client.py`)
- Added `_is_rate_limit_error()` module-level helper using `HttpError.status_code` + string matching fallback
- Added `_execute_with_retry()` method: exponential backoff with jitter for 429 errors, passes `num_retries` for 5xx/transport
- Updated `__init__` to accept rate-limit settings: `max_retries`, `initial_backoff_seconds`, `max_backoff_seconds`, `inter_page_delay_seconds`, `num_retries`
- `list_labels()` and `discover_message_ids()` now use `_execute_with_retry()` instead of raw `.execute()`
- `fetch_messages_batch()` wraps entire batch in retry loop (BatchHttpRequest.execute() doesn't accept num_retries)
- Inter-page delay added between discovery pages (not before first page)

### Settings (`settings.py`)
- Added 6 new fields: `max_retries`, `initial_backoff_seconds`, `max_backoff_seconds`, `inter_batch_delay_seconds`, `inter_page_delay_seconds`, `num_retries`

### Pipeline (`ingestor.py`)
- Wired all rate-limit settings to `GmailClient` constructor in `_ensure_initialized()`
- Added `time.sleep(inter_batch_delay_seconds)` between fetch batches
- `RateLimitError` now re-raised (not caught by generic `GmailIngestorError` handler)

### CLI (`cli.py`)
- `fetch` and `discover` commands now split `--label` on commas for multi-label support
- Sequential execution per label (natural throttling via inter-batch/inter-page delays)

### Tests
- 51 tests across `test_gmail_client.py` and `test_ingestor.py` (up from ~35)
- New test classes: `TestIsRateLimitError`, `TestExecuteWithRetry`, `TestInterBatchDelay`, `TestRateLimitErrorPropagation`
- All 259 tests pass

### Documentation
- Updated SKILL.md, ARCHITECTURE.md, README.md with new env vars, multi-label flag, recipes
